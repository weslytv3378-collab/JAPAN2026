<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾è²“æ—…è¨˜ (å–®æ©Ÿé›¢ç·šç‰ˆ)</title>
    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2e8b57">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font: Zen Maru Gothic -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-bounce-slow { animation: bounce 4s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(-5%); } 50% { transform: translateY(5%); } }
    </style>
</head>
<body class="bg-[#f4f1ea]">
    <!-- Main App Container -->
    <div id="app-container" class="h-screen w-full flex flex-col relative">
        <!-- Content will be rendered here -->
    </div>

    <!-- Edit Modal (Hidden by default) -->
    <div id="edit-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 items-end sm:items-center justify-center hidden">
        <div id="modal-content" class="bg-white w-full sm:max-w-md h-[90vh] sm:h-auto sm:max-h-[90vh] rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-slide-up">
            <!-- Modal content dynamically injected here -->
        </div>
    </div>

    <script type="module">
        // --- Global State and Constants ---
        const ALARM_SOUND_URL = "https://actions.google.com/sounds/v1/alarms/beep_short.ogg";
        const STORAGE_KEY = 'totoro_trip_data_v1';
        const appContainer = document.getElementById('app-container');
        const editModal = document.getElementById('edit-modal');
        const modalContent = document.getElementById('modal-content');

        let state = {
            view: 'home', // 'home' | 'app'
            events: [],
            currentDay: 1,
            editItem: null,
            exchangeRate: 0.22,
            isRateEditing: false,
            deleteConfirmId: null,
        };

        // --- FULL INITIAL DATA (Default Data) ---
        const INITIAL_ITINERARY = [
          // --- DAY 1 ---
          {
            id: 'd1-1', day: 1, time: '06:45', endTime: '07:15', type: 'spot',
            title: 'èµ·åºŠ & æ•´ç†è¡Œæ', location: 'La\'gent Stay å‡½é¤¨ç«™å‰',
            description: '06:45 èµ·åºŠï¼Œæ•´ç†è¡Œæã€‚',
            guideTips: 'ä»Šæ—¥é‡é»ï¼šå®Œæˆå¤§è¡Œæå¯„é€ã€å…«ç”²ç”°å±±æ¨¹å†°ã€å¼˜å‰åŸå¤œæ™¯ã€‚',
            expenses: [], tags: ['æº–å‚™'], completed: false
          },
          {
            id: 'd1-2', day: 1, time: '07:15', endTime: '08:15', type: 'food',
            title: 'æ—©é¤ @ La\'gent Stay', location: 'La\'gent Stay å‡½é¤¨ç«™å‰ 2Fã€ŒPREGALOã€',
            description: 'å»ºè­°ï¼šè‡ªè£½æµ·é®®ä¸¼å¿…åƒï¼Œå»ºè­° 07:15 å‰å…¥å ´ã€‚',
            guideTips: 'ä¸€å®šè¦è©¦è©¦çœ‹è‡ªè£½æµ·é®®ä¸¼ï¼',
            expenses: [], tags: ['å¿…åƒ', 'æµ·é®®ä¸¼'], completed: false
          },
          {
            id: 'd1-3', day: 1, time: '08:30', endTime: '08:50', type: 'transport',
            title: 'é€€æˆ¿ & å‰å¾€å‡½é¤¨ç«™', location: 'å‡½é¤¨ç«™',
            description: 'é€€æˆ¿ï¼Œæ‹‰è‘—å¤§å°è¡Œæå‰å¾€å‡½é¤¨ç«™ï¼ˆæ­¥è¡Œ 1 åˆ†é˜ï¼‰ã€‚',
            guideTips: '',
            expenses: [], tags: ['ç§»å‹•'], completed: false
          },
          {
            id: 'd1-4', day: 1, time: '08:54', endTime: '09:35', type: 'transport',
            title: 'å¿«é€Ÿ Hakodate Liner -> æ–°å‡½é¤¨åŒ—æ–—', location: 'æ–°å‡½é¤¨åŒ—æ–—ç«™',
            description: 'æ­ä¹˜ å¿«é€Ÿ Hakodate Liner å‰å¾€æ–°å‡½é¤¨åŒ—æ–—ç«™ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd1-5', day: 1, time: '09:35', endTime: '10:37', type: 'transport',
            title: 'æ–°å¹¹ç·š Hayabusa 16è™Ÿ -> æ–°é’æ£®', location: 'æ–°é’æ£®ç«™',
            description: 'è½‰ä¹˜ æ–°å¹¹ç·š Hayabusa 16è™Ÿ å‰å¾€æ–°é’æ£®ã€‚\n10:37 æŠµé” æ–°é’æ£®ç«™ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd1-6', day: 1, time: '10:40', endTime: '10:50', type: 'luggage',
            title: 'ğŸ§³ æ–°é’æ£®ç«™è¡Œæé—œéµå‹•ä½œ', location: 'æ–°é’æ£®ç«™ 1F æ—¬å‘³é¤¨æ—',
            description: '1. å‡ºç«™æ‰¾ã€Œé»‘è²“å®…æ€¥ä¾¿ã€æˆ–ä½å·æ€¥ä¾¿ã€‚\n2. å°‡ å¤§è¡Œæç®± å¯„å¾€ 1/17 å…¥ä½çš„ã€ŒRichmond Hotel ç§‹ç”°ç«™å‰ã€ã€‚\n3. å°‡ å°è¡Œæç®± å¯„æ”¾åœ¨è»Šç«™å…§çš„ æŠ•å¹£å¼ç½®ç‰©æ«ƒã€‚\n4. åªèƒŒè‘—å¾ŒèƒŒåŒ…å»æ­å·´å£«ã€‚',
            guideTips: 'æ¥µé‡è¦ï¼ä¸€å®šè¦åœ¨é€™è£¡æŠŠå¤§è¡Œæå¯„èµ°ï¼Œä¸ç„¶å…«ç”²ç”°å±±æœƒå¾ˆç—›è‹¦ã€‚',
            expenses: [{ item: 'å®…æ€¥ä¾¿', cost: 2500 }, { item: 'ç½®ç‰©æ«ƒ', cost: 500 }],
            tags: ['æ¥µé‡è¦', 'è¡Œæç­–ç•¥'], completed: false
          },
          {
            id: 'd1-7', day: 1, time: '10:50', endTime: '11:10', type: 'food',
            title: 'åˆé¤å»ºè­° (è²·ä¾¿ç•¶å¸¶èµ°)', location: 'æ–°é’æ£®ç«™',
            description: 'ä¸‰é¸ä¸€ï¼š\n1. æ–°é’æ£®ç«™ä¾¿ç•¶ (æ—¬å‘³é¤¨)ï¼šæ´¥è¼•æµ·å³½æµ·é®®ä¾¿ç•¶ã€‚\n2. å‰ç”°å±‹å¹²è²é‡œé£¯ï¼šç«™å…§ç†±é–€æ¬¾ã€‚\n3. å‡½é¤¨æµ·è†½ä¾¿ç•¶ï¼šè‹¥æ—©ä¸Šåœ¨å‡½é¤¨ç«™æœ‰å…ˆè²·å¥½çš„è©±ã€‚',
            guideTips: 'è²·å¥½ä¾¿ç•¶å¯ä»¥åœ¨å·´å£«ä¸Šæˆ–å±±ä¸Šä¼‘æ¯è™•åƒã€‚',
            expenses: [{ item: 'ä¾¿ç•¶', cost: 1200 }], tags: ['åˆé¤'], completed: false
          },
          {
            id: 'd1-8', day: 1, time: '11:10', endTime: '12:15', type: 'transport',
            title: 'JRå·´å£«ã€Œå…«ç”²ç”°6è™Ÿã€ä¸Šå±±', location: 'æ–°é’æ£®ç«™æ±å£',
            description: 'æ–¼æ–°é’æ£®ç«™æ±å£ï¼Œæ­ä¹˜ JRå·´å£«ã€Œå…«ç”²ç”°6è™Ÿã€ ä¸Šå±±ã€‚',
            guideTips: '',
            expenses: [{ item: 'å·´å£«', cost: 0 }], tags: ['å·´å£«'], completed: false
          },
          {
            id: 'd1-9', day: 1, time: '12:15', endTime: '15:00', type: 'spot',
            title: 'ã€æ™¯é»ã€‘å…«ç”²ç”°å±±æ¨¹å†°', location: 'å…«ç”²ç”°çºœè»Šå±±é ‚å…¬åœ’ç«™',
            description: 'æ­çºœè»Šä¿¯ç°ã€Œé›ªæ€ªã€é‡è‘‰æ—ï¼Œå ´é¢å£¯è§€ã€‚',
            guideTips: 'æ³¨æ„ï¼šå±±é ‚æ¥µå†· (-10åº¦)ï¼Œå‹™å¿…å…¨å‰¯æ­¦è£ã€‚é¢¨å¤§æ™‚çºœè»Šå¯èƒ½åœé§›ï¼Œéœ€ç•™æ„é‹è¡Œç‹€æ³ã€‚',
            expenses: [{ item: 'çºœè»Šä¾†å›', cost: 2000 }], tags: ['å¿…çœ‹', 'æ¥µå†·'], completed: false
          },
          {
            id: 'd1-10', day: 1, time: '15:03', endTime: '16:13', type: 'transport',
            title: 'JRå·´å£«ã€Œå…«ç”²ç”°5è™Ÿã€ä¸‹å±±', location: 'å…«ç”²ç”°çºœè»Šç«™',
            description: 'æ­ä¹˜ JRå·´å£«ã€Œå…«ç”²ç”°5è™Ÿã€ ä¸‹å±±ã€‚\n16:13 æŠµé”æ–°é’æ£®ç«™ã€‚',
            guideTips: 'âš ï¸ çµ•å°æ­»ç·šï¼éŒ¯éé€™ç­å°±éº»ç…©äº†ã€‚',
            expenses: [], tags: ['åš´æ ¼å®ˆæ™‚', 'å·´å£«'], completed: false
          },
          {
            id: 'd1-11', day: 1, time: '16:13', endTime: '16:30', type: 'luggage',
            title: 'ğŸ§³ å–å‡ºå°è¡Œæç®±', location: 'æ–°é’æ£®ç«™ ç½®ç‰©æ«ƒ',
            description: 'å¾ç½®ç‰©æ«ƒå–å‡º å°è¡Œæç®±ã€‚',
            guideTips: '',
            expenses: [], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd1-12', day: 1, time: '16:38', endTime: '17:16', type: 'transport',
            title: 'JRå¥§ç¾½æœ¬ç·š -> å¼˜å‰', location: 'å¼˜å‰ç«™',
            description: 'æ­ä¹˜ JRå¥§ç¾½æœ¬ç·š å‰å¾€å¼˜å‰ã€‚\n17:16 æŠµé”å¼˜å‰ç«™ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd1-13', day: 1, time: '17:16', endTime: '17:30', type: 'luggage',
            title: 'ğŸ§³ å¯„æ”¾å°è¡Œæç®±', location: 'å¼˜å‰ç«™ ç½®ç‰©æ«ƒ',
            description: 'å°‡ å°è¡Œæç®± å¯„æ”¾åœ¨å¼˜å‰ç«™ ç½®ç‰©æ«ƒã€‚',
            guideTips: '',
            expenses: [{ item: 'ç½®ç‰©æ«ƒ', cost: 500 }], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd1-14', day: 1, time: '17:30', endTime: '17:45', type: 'transport',
            title: 'è¨ˆç¨‹è»Š -> å¼˜å‰å…¬åœ’', location: 'å¼˜å‰å…¬åœ’',
            description: 'æ­è¨ˆç¨‹è»Šå‰å¾€å¼˜å‰å…¬åœ’ã€‚',
            guideTips: '',
            expenses: [{ item: 'è¨ˆç¨‹è»Šå»ç¨‹', cost: 1200 }], tags: ['è¨ˆç¨‹è»Š'], completed: false
          },
          {
            id: 'd1-15', day: 1, time: '17:45', endTime: '18:30', type: 'spot',
            title: 'ã€æ™¯é»ã€‘å¼˜å‰åŸ å†¬ä¹‹æ«»é»ç‡ˆ', location: 'å¼˜å‰å…¬åœ’ è¿½æ‰‹é–€',
            description: 'ç²‰ç´…ç‡ˆå…‰æ‰“åœ¨ç©é›ªæ«»èŠ±æ¨¹ä¸Šï¼Œå¤¢å¹»é›ªæ™¯ã€‚',
            guideTips: 'ä¸»è¦è§€è³é»åœ¨è¿½æ‰‹é–€é™„è¿‘çš„è­·åŸæ²³ç•”ã€‚',
            expenses: [], tags: ['å¤œæ™¯'], completed: false
          },
          {
            id: 'd1-16', day: 1, time: '18:40', endTime: '19:00', type: 'transport',
            title: 'è¨ˆç¨‹è»Š -> å¼˜å‰ç«™', location: 'å¼˜å‰ç«™',
            description: 'æ­è¨ˆç¨‹è»Šå›åˆ°å¼˜å‰ç«™ã€‚',
            guideTips: '',
            expenses: [{ item: 'è¨ˆç¨‹è»Šå›ç¨‹', cost: 1200 }], tags: ['è¨ˆç¨‹è»Š'], completed: false
          },
          {
            id: 'd1-17', day: 1, time: '19:00', endTime: '19:17', type: 'shopping',
            title: 'ğŸ§³ å–è¡Œæ & è²·åœŸç”¢', location: 'å¼˜å‰ç«™',
            description: '1. å–å› å°è¡Œæç®±ã€‚\n2. ğŸ å¼˜å‰åœŸç”¢ï¼šRagnoo è˜‹æœæ´¾ã€Shiny è˜‹æœæ±ã€å¤§è’œä»™è²ã€‚',
            guideTips: 'åˆ¥å¿˜äº†å–è¡Œæï¼',
            expenses: [{ item: 'åœŸç”¢', cost: 2000 }], tags: ['è¡Œæå‹•ä½œ', 'ä¼´æ‰‹ç¦®'], completed: false
          },
          {
            id: 'd1-18', day: 1, time: '19:17', endTime: '20:10', type: 'transport',
            title: 'JRå¥§ç¾½æœ¬ç·š -> æ–°é’æ£®', location: 'æ–°é’æ£®ç«™',
            description: 'æ­ä¹˜ JRå¥§ç¾½æœ¬ç·š è¿”å›æ–°é’æ£®ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd1-19', day: 1, time: '20:17', endTime: '21:52', type: 'transport',
            title: 'æ–°å¹¹ç·š Hayabusa 48è™Ÿ -> ä»™å°', location: 'ä»™å°ç«™',
            description: 'è½‰ä¹˜ æ–°å¹¹ç·š Hayabusa 48è™Ÿ å‰å¾€ä»™å°ã€‚\n21:52 æŠµé”ä»™å°ç«™ã€‚',
            guideTips: 'è»Šç¨‹è¼ƒé•·ï¼Œå¯ä»¥ä¼‘æ¯ä¸€ä¸‹ã€‚',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd1-20', day: 1, time: '22:10', endTime: '22:30', type: 'hotel',
            title: 'Check-in å¾¡å®¿ é‡ä¹ƒ ä»™å°', location: 'å¤©ç„¶æº«æ³‰ æœéƒ½ä¹‹æ¹¯ å¾¡å®¿ é‡ä¹ƒ ä»™å°',
            description: 'æ­è¨ˆç¨‹è»Šå‰å¾€é£¯åº— Check-inã€‚',
            guideTips: 'å…¨é¤¨å¡Œå¡Œç±³ï¼Œæœ‰æº«æ³‰å¯ä»¥æ³¡ã€‚',
            expenses: [{ item: 'è¨ˆç¨‹è»Š', cost: 1000 }], tags: ['ä½å®¿', 'æº«æ³‰'], completed: false
          },
          {
            id: 'd1-21', day: 1, time: '22:30', endTime: '23:30', type: 'food',
            title: 'æ™šé¤/å®µå¤œå»ºè­° (ä¸‰é¸ä¸€)', location: 'ä»™å°ç«™å‰',
            description: '1. å–„æ²»éƒ (ç«™å‰æœ¬åº—)ï¼šæ¥µåšç‚­çƒ¤ç‰›èˆŒã€‚\n2. åˆ©ä¹… (ç«™å‰åº—)ï¼šç¶“å…¸ç‰›èˆŒå®šé£Ÿã€‚\n3. ãšã‚“ã èŒ¶å¯®ï¼šæ¯›è±†æ³¥å¥¶æ˜” (è‹¥é—œé–€å¯æ”¹è²·ä¾¿åˆ©åº—)ã€‚',
            guideTips: 'æ¥µåšç‚­çƒ¤ç‰›èˆŒæ˜¯ä»™å°å¿…åƒï¼',
            expenses: [{ item: 'æ™šé¤', cost: 3000 }], tags: ['å¿…åƒ', 'ç¾é£Ÿ'], completed: false
          },
          {
            id: 'd2-1', day: 2, time: '08:30', endTime: '09:00', type: 'hotel',
            title: 'é£¯åº—æ—©é¤ & Check-out', location: 'å¾¡å®¿ é‡ä¹ƒ ä»™å°',
            description: 'é£¯åº—æ—©é¤å¾Œ Check-outã€‚\nğŸ§³ è¡Œæå‹•ä½œï¼šæ‹‰è‘— å°è¡Œæç®± ç§»å‹•ã€‚',
            guideTips: 'ä»Šæ—¥é‡é»ï¼šä¿®æ­£å¾Œçš„å·´å£«æ™‚é–“è®“æ‚¨åœ¨ç”°æ¾¤æ¹–ç«™æœ‰è¼ƒå¤šç­‰å¾…æ™‚é–“ï¼Œå»ºè­°åœ¨è»Šç«™æ¡è²·è£œçµ¦å“ã€‚',
            expenses: [], tags: ['è¡Œæç§»å‹•'], completed: false
          },
          {
            id: 'd2-2', day: 2, time: '09:44', endTime: '09:58', type: 'transport',
            title: 'æ–°å¹¹ç·š -> ç™½çŸ³è—ç‹', location: 'ç™½çŸ³è—ç‹ç«™',
            description: 'å¾ä»™å°ç«™æ­ä¹˜ æ–°å¹¹ç·š å‰å¾€ç™½çŸ³è—ç‹ç«™ã€‚\n09:58 æŠµé”ç™½çŸ³è—ç‹ç«™ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd2-3', day: 2, time: '09:58', endTime: '10:05', type: 'luggage',
            title: 'ğŸ§³ å¯„æ”¾å°è¡Œæç®±', location: 'ç™½çŸ³è—ç‹ç«™ ç½®ç‰©æ«ƒ',
            description: 'å°‡ å°è¡Œæç®± å¯„æ”¾åœ¨è»Šç«™ ç½®ç‰©æ«ƒã€‚',
            guideTips: '',
            expenses: [{ item: 'ç½®ç‰©æ«ƒ', cost: 500 }], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd2-4', day: 2, time: '10:05', endTime: '10:30', type: 'transport',
            title: 'è¨ˆç¨‹è»Š -> è—ç‹ç‹ç‹¸æ‘', location: 'å®®åŸè—ç‹ç‹ç‹¸æ‘',
            description: 'æ­ä¹˜ è¨ˆç¨‹è»Š å‰å¾€è—ç‹ç‹ç‹¸æ‘ (ç´„ 4,500 æ—¥åœ“)ã€‚',
            guideTips: 'å¦‚æœæœ‰é‡åˆ°å…¶ä»–éŠå®¢ï¼Œå¯ä»¥è€ƒæ…®å…±ä¹˜çœéŒ¢ã€‚',
            expenses: [{ item: 'è¨ˆç¨‹è»Š', cost: 4500 }], tags: ['è¨ˆç¨‹è»Š'], completed: false
          },
          {
            id: 'd2-5', day: 2, time: '10:30', endTime: '12:00', type: 'spot',
            title: 'ã€æ™¯é»ã€‘è—ç‹ç‹ç‹¸æ‘', location: 'å®®åŸè—ç‹ç‹ç‹¸æ‘',
            description: 'å†¬å­£ç‹ç‹¸æ¯›è‰²è“¬é¬†ã€‚å‹™å¿…åƒåŠ  11:00 çš„æŠ±ç‹ç‹¸é«”é©—ã€‚',
            guideTips: 'æ³¨æ„æ‰‹æ©Ÿå’Œéš¨èº«ç‰©å“ï¼Œç‹ç‹¸æœƒå’¬å‚å¢œç‰©ã€‚',
            expenses: [{ item: 'é–€ç¥¨', cost: 1000 }, { item: 'æŠ±ç‹ç‹¸', cost: 600 }], tags: ['å¿…å»'], completed: false
          },
          {
            id: 'd2-6', day: 2, time: '12:10', endTime: '12:46', type: 'transport',
            title: 'å·´å£« -> ç™½çŸ³è—ç‹ç«™', location: 'ç™½çŸ³è—ç‹ç«™',
            description: 'æ­ä¹˜ å·´å£« è¿”å›ç™½çŸ³è—ç‹ç«™ã€‚\n12:46 æŠµé”ç™½çŸ³è—ç‹ç«™ã€‚',
            guideTips: '',
            expenses: [{ item: 'å·´å£«', cost: 800 }], tags: ['å·´å£«'], completed: false
          },
          {
            id: 'd2-7', day: 2, time: '12:46', endTime: '13:50', type: 'food',
            title: 'åˆé¤å»ºè­° (ä¸‰é¸ä¸€)', location: 'ç™½çŸ³è—ç‹ç«™',
            description: '1. ç™½çŸ³è—ç‹ç«™å…§è¼•é£Ÿï¼šçƒé¾éºµ/è•éº¥éºµã€‚\n2. ä¾¿åˆ©å•†åº— (NewDays)ï¼šç°¡å–®é£¯ç³°ã€‚\n3. è»Šç«™é™„è¿‘å°åº—ï¼šè‹¥æœ‰é–‹å¯å˜—è©¦æº«éºµã€‚\n(é€™è£¡æœ‰ç´„ 1 å°æ™‚ç©ºæª”ï¼Œè«‹å–å›å°è¡Œæç®±)ã€‚',
            guideTips: '',
            expenses: [{ item: 'åˆé¤', cost: 1000 }], tags: ['åˆé¤'], completed: false
          },
          {
            id: 'd2-8', day: 2, time: '13:50', endTime: '13:51', type: 'luggage',
            title: 'ğŸ§³ å–å›å°è¡Œæç®±', location: 'ç™½çŸ³è—ç‹ç«™ ç½®ç‰©æ«ƒ',
            description: 'è«‹å–å›å°è¡Œæç®±ï¼Œæº–å‚™ä¸Šè»Šã€‚',
            guideTips: '',
            expenses: [], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd2-9', day: 2, time: '13:51', endTime: '14:04', type: 'transport',
            title: 'æ–°å¹¹ç·š -> ä»™å°ç«™', location: 'ä»™å°ç«™',
            description: 'æ­ä¹˜ æ–°å¹¹ç·š å‰å¾€ä»™å°ç«™ã€‚\nğŸ§³ è¡Œæå‹•ä½œï¼šå¸¶è‘— å°è¡Œæç®± ä¸Šè»Šã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd2-10', day: 2, time: '14:04', endTime: '14:34', type: 'shopping',
            title: 'ä»™å°è½‰ä¹˜ & è²·åœŸç”¢', location: 'ä»™å°ç«™',
            description: 'æŠµé”ä»™å°ç«™ï¼Œè½‰ä¹˜ä¸‹ä¸€ç­è»Šã€‚\nğŸ ã€ä»™å°åœŸç”¢ã€‘ï¼šè©ä¹‹æœˆã€å–œä¹…ç¦ã€ä¼Šé”ç‰›èˆŒã€‚',
            guideTips: 'åˆ©ç”¨è½‰ä¹˜ç©ºæª”è²·äº›è»Šä¸Šåƒçš„æˆ–ä¼´æ‰‹ç¦®ã€‚',
            expenses: [{ item: 'åœŸç”¢', cost: 2000 }], tags: ['ä¼´æ‰‹ç¦®'], completed: false
          },
          {
            id: 'd2-11', day: 2, time: '14:34', endTime: '15:44', type: 'transport',
            title: 'æ–°å¹¹ç·š Komachi 23è™Ÿ -> ç”°æ¾¤æ¹–', location: 'ç”°æ¾¤æ¹–ç«™',
            description: 'æ­ä¹˜ æ–°å¹¹ç·š Komachi 23è™Ÿ å‰å¾€ç”°æ¾¤æ¹–ç«™ã€‚\n15:44 æŠµé” ç”°æ¾¤æ¹–ç«™ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd2-12', day: 2, time: '15:44', endTime: '16:35', type: 'shopping',
            title: 'âš ï¸ ç­‰å¾…èˆ‡è£œçµ¦ (50åˆ†é˜)', location: 'ç”°æ¾¤æ¹–ç«™',
            description: 'ä¸‹ä¸€ç­å·´å£«æ˜¯ 16:35ã€‚æ‚¨æœ‰ç´„ 50 åˆ†é˜ã€‚\nè¡Œå‹•ï¼šåœ¨è»Šç«™å…§çš„ä¾¿åˆ©å•†åº—è²·å¥½æ™šä¸Šåœ¨æº«æ³‰å–çš„é…’æ°´ã€é›¶é£Ÿï¼ˆå±±ä¸Šæ²’æœ‰å•†åº—ï¼‰ã€‚äº¦å¯é€›é€›è»Šç«™çš„è§€å…‰æ¡ˆå…§æ‰€ã€‚',
            guideTips: 'å±±ä¸ŠçœŸçš„æ²’æœ‰ä¾¿åˆ©å•†åº—ï¼Œè«‹å‹™å¿…åœ¨æ­¤è£œçµ¦ï¼',
            expenses: [{ item: 'é…’æ°´é›¶é£Ÿ', cost: 1500 }], tags: ['é‡è¦è£œçµ¦'], completed: false
          },
          {
            id: 'd2-13', day: 2, time: '16:35', endTime: '17:20', type: 'transport',
            title: 'å·´å£«ã€Œä¹³é ­ç·šã€-> ä¼‘æš‡æ‘', location: 'ä¼‘æš‡æ‘å‰ç«™',
            description: 'ã€å·´å£«æ™‚åˆ»ä¿®æ­£ã€‘ æ­ä¹˜ ç¾½å¾Œäº¤é€šå·´å£«ã€Œä¹³é ­ç·šã€ (å¾€ä¹³é ­èŸ¹å ´æº«æ³‰æ–¹å‘)ã€‚\nğŸ§³ è¡Œæå‹•ä½œï¼šæŠŠ å°è¡Œæç®± å¸¶ä¸Šå·´å£«ã€‚\n17:20 æŠµé” ä¼‘æš‡æ‘å‰ (Kyukamura-mae) ç«™ã€‚',
            guideTips: '',
            expenses: [{ item: 'å·´å£«', cost: 840 }], tags: ['å·´å£«', 'è¡Œæç§»å‹•'], completed: false
          },
          {
            id: 'd2-14', day: 2, time: '17:30', endTime: '18:30', type: 'hotel',
            title: 'Check-in ä¼‘æš‡æ‘ ä¹³é ­æº«æ³‰é„‰', location: 'ä¼‘æš‡æ‘ ä¹³é ­æ¸©æ³‰éƒ·',
            description: 'Check-in ä¼‘æš‡æ‘ ä¹³é ­æº«æ³‰é„‰ã€‚',
            guideTips: 'è¢«æ«¸æœ¨æ—åŒ…åœçš„é›ªè¦‹æº«æ³‰ã€‚',
            expenses: [{ item: 'ä½å®¿', cost: 15000 }], tags: ['ä½å®¿', 'æº«æ³‰'], completed: false
          },
          {
            id: 'd2-15', day: 2, time: '18:30', endTime: '20:00', type: 'food',
            title: 'æ™šé¤ï¼šé£¯åº—è‡ªåŠ©ç™¾åŒ¯', location: 'ä¼‘æš‡æ‘ ä¹³é ­æ¸©æ³‰éƒ·',
            description: 'é£¯åº—è‡ªåŠ©ç™¾åŒ¯ï¼šäº«ç”¨ç§‹ç”°ç±³æ£’é‹ã€å±±è—¥é‹èˆ‡ç”°æ¾¤æ¹–åœ¨åœ°æ–™ç†ã€‚',
            guideTips: 'ç±³æ£’é‹æ˜¯ç§‹ç”°åç‰©ï¼',
            expenses: [], tags: ['æ™šé¤', 'å¿…åƒ'], completed: false
          },
          {
            id: 'd2-16', day: 2, time: '21:00', endTime: '22:00', type: 'food',
            title: 'å®µå¤œå»ºè­° (ä¸‰é¸ä¸€)', location: 'ä¼‘æš‡æ‘ ä¹³é ­æ¸©æ³‰éƒ·',
            description: '1. è‡ªå‚™ä»™å°åœŸç”¢ï¼šè©ä¹‹æœˆã€‚\n2. é£¯åº—è²©è³£æ©Ÿï¼šç•¶åœ°ç‰›å¥¶æˆ–å•¤é…’ã€‚\n3. é£¯åº—è³£åº—ï¼šè³¼è²·ç§‹ç”°é›¶é£Ÿã€‚',
            guideTips: 'äº«å—ç§˜æ¹¯ä¹‹å¤œã€‚',
            expenses: [{ item: 'ç‰›å¥¶', cost: 200 }], tags: ['å®µå¤œ'], completed: false
          },
          {
            id: 'd3-1', day: 3, time: '09:00', endTime: '09:15', type: 'hotel',
            title: 'Check-out & å¯„è¡Œæ', location: 'ä¼‘æš‡æ‘ ä¹³é ­æ¸©æ³‰éƒ·',
            description: 'é£¯åº— Check-outã€‚\nğŸ§³ è¡Œæå‹•ä½œï¼šå°‡ å°è¡Œæç®± å¯„æ”¾åœ¨ ä¼‘æš‡æ‘æ«ƒå°ã€‚èƒŒèƒŒåŒ…è¼•è£å‡ºç™¼ã€‚',
            guideTips: 'ä»Šæ—¥é‡é»ï¼šä¾æ“šå·´å£«æ™‚åˆ»è¡¨ï¼Œæ‚¨ä¸­åˆæœ‰å……è£•æ™‚é–“åœ¨è»Šç«™åƒåˆé¤ï¼Œä¸‹åˆæ­ä¹˜å”¯ä¸€çš„ç’°æ¹–è§€å…‰å·´å£«ã€‚',
            expenses: [], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd3-2', day: 3, time: '09:15', endTime: '10:15', type: 'spot',
            title: 'ã€é«”é©—ã€‘å¦™ä¹ƒæ¹¯ (æ—¥æ­¸å…¥æµ´)', location: 'å¦™ä¹ƒæ¹¯',
            description: 'äº¤é€šï¼šå¾ä¼‘æš‡æ‘æ­¥è¡Œ 10 åˆ†é˜ã€‚\nä»‹ç´¹ï¼šç²¾ç·»çš„æ··æµ´éœ²å¤©é¢¨å‘‚ (å¯åœæ¯›å·¾)ï¼Œçœ‹å¾—åˆ°ç€‘å¸ƒèˆ‡æºªæµã€‚',
            guideTips: 'æ··æµ´å¯åœæ¯›å·¾ï¼Œå¥³ç”Ÿä¹Ÿå¯å®‰å¿ƒã€‚',
            expenses: [{ item: 'å…¥æµ´æ–™', cost: 800 }], tags: ['æ³¡æ¹¯'], completed: false
          },
          {
            id: 'd3-3', day: 3, time: '10:15', endTime: '10:45', type: 'transport',
            title: 'é›ªåœ°æ­¥è¡Œ -> èŸ¹å ´æº«æ³‰', location: 'ä¹³é ­æº«æ³‰é„‰',
            description: 'æ­¥è¡Œå‰å¾€èŸ¹å ´æº«æ³‰ (é›ªåœ°æ­¥è¡Œç´„ 25-30 åˆ†é˜)ã€‚',
            guideTips: 'äº«å—é›ªä¸­æ¼«æ­¥çš„æ¨‚è¶£ï¼Œæ³¨æ„è…³ä¸‹é˜²æ»‘ã€‚',
            expenses: [], tags: ['æ­¥è¡Œ'], completed: false
          },
          {
            id: 'd3-4', day: 3, time: '10:45', endTime: '11:45', type: 'spot',
            title: 'ã€é«”é©—ã€‘èŸ¹å ´æº«æ³‰ (æ—¥æ­¸å…¥æµ´)', location: 'èŸ¹å ´æ¸©æ³‰',
            description: 'ä»‹ç´¹ï¼šéœ€èµ°å‡ºæˆ¶å¤–ç©¿éé›ªå¾‘æ‰èƒ½æŠµé”çš„é‡è¶£éœ²å¤©æº«æ³‰ã€‚',
            guideTips: 'éå¸¸åŸå§‹è‡ªç„¶çš„ç’°å¢ƒï¼Œå››å‘¨éƒ½æ˜¯æ£®æ—ã€‚',
            expenses: [{ item: 'å…¥æµ´æ–™', cost: 800 }], tags: ['æ³¡æ¹¯'], completed: false
          },
          {
            id: 'd3-5', day: 3, time: '11:45', endTime: '12:15', type: 'transport',
            title: 'æ­¥è¡Œå›ä¼‘æš‡æ‘', location: 'ä¼‘æš‡æ‘ ä¹³é ­æ¸©æ³‰éƒ·',
            description: 'æ­¥è¡Œèµ°å›ä¼‘æš‡æ‘ã€‚',
            guideTips: '',
            expenses: [], tags: ['æ­¥è¡Œ'], completed: false
          },
          {
            id: 'd3-6', day: 3, time: '12:15', endTime: '13:30', type: 'spot',
            title: 'ä¼‘æ¯ & é ˜å–è¡Œæ', location: 'ä¼‘æš‡æ‘ ä¹³é ­æ¸©æ³‰éƒ·',
            description: 'åœ¨ä¼‘æš‡æ‘å¤§å»³ä¼‘æ¯ã€æ•´ç†å„€å®¹ã€é ˜å–è¡Œæã€‚\nğŸ§³ è¡Œæå‹•ä½œï¼šé ˜å› å°è¡Œæç®±ã€‚',
            guideTips: 'æº–å‚™ä¸‹å±±å›‰ã€‚',
            expenses: [], tags: ['ä¼‘æ¯', 'è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd3-7', day: 3, time: '13:43', endTime: '14:28', type: 'transport',
            title: 'å·´å£« -> ç”°æ¾¤æ¹–ç«™', location: 'ç”°æ¾¤æ¹–ç«™',
            description: 'ã€å·´å£«æ™‚åˆ»ä¿®æ­£ã€‘ æ–¼ã€Œä¼‘æš‡æ‘å‰ã€æ­ä¹˜ ç¾½å¾Œäº¤é€šå·´å£« (å¾€ç”°æ¾¤æ¹–ç«™)ã€‚\n14:28 æŠµé” ç”°æ¾¤æ¹–ç«™ã€‚',
            guideTips: '',
            expenses: [{ item: 'å·´å£«', cost: 840 }], tags: ['å·´å£«'], completed: false
          },
          {
            id: 'd3-8', day: 3, time: '14:28', endTime: '14:30', type: 'luggage',
            title: 'ğŸ§³ å¯„æ”¾å°è¡Œæç®±', location: 'ç”°æ¾¤æ¹–ç«™ ç½®ç‰©æ«ƒ',
            description: 'å°‡ å°è¡Œæç®± å¯„æ”¾åœ¨ç”°æ¾¤æ¹–ç«™ ç½®ç‰©æ«ƒã€‚',
            guideTips: '',
            expenses: [{ item: 'ç½®ç‰©æ«ƒ', cost: 500 }], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd3-9', day: 3, time: '14:30', endTime: '15:15', type: 'food',
            title: 'åˆé¤å»ºè­° (ä¸‰é¸ä¸€)', location: 'ç”°æ¾¤æ¹–ç«™å‰',
            description: '1. é§…å‰é£Ÿå ‚ï¼šæ¯”å…§åœ°é›è¦ªå­ä¸¼ã€ç¨»åº­çƒé¾éºµã€‚\n2. è•éº¥éºµäº”éƒ (ãã°äº”éƒ)ï¼šä½æ–¼è»Šç«™æ—çš„å¸‚é›†å…§ã€‚\n3. ä¾¿åˆ©å•†åº—ï¼šè‹¥é¤å»³å®¢æ»¿çš„å‚™æ¡ˆã€‚',
            guideTips: 'æ¯”å…§åœ°é›æ˜¯ç§‹ç”°åç”¢ï¼Œè‚‰è³ªæœ‰åš¼å‹ã€‚',
            expenses: [{ item: 'åˆé¤', cost: 1500 }], tags: ['åˆé¤'], completed: false
          },
          {
            id: 'd3-10', day: 3, time: '15:25', endTime: '16:56', type: 'spot',
            title: 'ç”°æ¾¤æ¹–ä¸€å‘¨ç·š è§€å…‰å·´å£«', location: 'ç”°æ¾¤æ¹–',
            description: 'ã€å·´å£«æ™‚åˆ»ä¿®æ­£ã€‘ æ­ä¹˜ ã€Œç”°æ¾¤æ¹–ä¸€å‘¨ç·šã€ è§€å…‰å·´å£«ã€‚\né€™ç­è»Šæ˜¯å°ˆç‚ºè§€å…‰è¨­è¨ˆçš„ï¼Œå¸æ©Ÿæœƒåœ¨æ™¯é»åœè»Šç­‰äººã€‚\n15:55 æŠµé”ã€æ½Ÿå°» (è¾°å­åƒ)ã€‘ï¼šåœç•™ 20 åˆ†é˜æ‹ç…§ (16:15 ç™¼è»Š)ã€‚\n16:25 æŠµé”ã€å¾¡åº§ä¹‹çŸ³ç¥ç¤¾ã€‘ï¼šåœç•™ 10 åˆ†é˜åƒæ‹œ (16:35 ç™¼è»Š)ã€‚\n16:56 å·´å£«å›åˆ° ç”°æ¾¤æ¹–ç«™ã€‚',
            guideTips: 'ä¸ç”¨è‡ªå·±æ‰¾äº¤é€šå·¥å…·ï¼Œå·´å£«æœƒç­‰ä½ ï¼Œéå¸¸æ–¹ä¾¿ï¼',
            expenses: [{ item: 'è§€å…‰å·´å£«', cost: 1210 }], tags: ['å¿…å»', 'è§€å…‰å·´å£«'], completed: false
          },
          {
            id: 'd3-11', day: 3, time: '16:56', endTime: '17:34', type: 'luggage',
            title: 'ğŸ§³ å–å›å°è¡Œæç®±', location: 'ç”°æ¾¤æ¹–ç«™ ç½®ç‰©æ«ƒ',
            description: 'å¾ç½®ç‰©æ«ƒå–å› å°è¡Œæç®±ã€‚\n(å‚™è¨»ï¼šå› å·´å£« 16:56 æ‰åˆ°ï¼Œè¶• 17:12 çš„è»Šæœ‰é»è¶•ï¼Œå»ºè­°æ­ 17:34 è¼ƒå¾å®¹)',
            guideTips: 'ä¼‘æ¯ä¸€ä¸‹æº–å‚™æ­æ–°å¹¹ç·šã€‚',
            expenses: [], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd3-12', day: 3, time: '17:34', endTime: '18:14', type: 'transport',
            title: 'æ–°å¹¹ç·š Komachi 34è™Ÿ -> ç››å²¡', location: 'ç››å²¡ç«™',
            description: 'æ­ä¹˜ æ–°å¹¹ç·š Komachi 34è™Ÿ å‰å¾€ç››å²¡ç«™ã€‚\n18:14 æŠµé”ç››å²¡ç«™ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd3-13', day: 3, time: '18:14', endTime: '18:30', type: 'luggage',
            title: 'ğŸ§³ å¯„æ”¾å°è¡Œæç®±', location: 'ç››å²¡ç«™ ç½®ç‰©æ«ƒ',
            description: 'å°‡ å°è¡Œæç®± å¯„æ”¾ç››å²¡ç«™ ç½®ç‰©æ«ƒã€‚',
            guideTips: '',
            expenses: [{ item: 'ç½®ç‰©æ«ƒ', cost: 500 }], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd3-14', day: 3, time: '18:30', endTime: '19:30', type: 'food',
            title: 'æ™šé¤å»ºè­°ï¼šç››å²¡å†·éºµ', location: 'ç››å²¡ç«™å‰',
            description: 'ä¸‰é¸ä¸€ï¼š\n1. ã´ã‚‡ã‚“ã´ã‚‡ã‚“èˆ (ç››å²¡ç«™å‰åº—)ï¼šå¿…åƒç››å²¡å†·éºµ+ç‡’è‚‰ã€‚\n2. ç››æ¨“é–£ï¼šå°±åœ¨è»Šç«™å°é¢ï¼Œé«˜ç´šå†·éºµååº—ã€‚\n3. é£Ÿé“åœ’ï¼šå†·éºµç™¼ç¥¥åº—ï¼Œæ¹¯é ­ç¨ç‰¹ã€‚\nğŸ ã€ç››å²¡/ç§‹ç”°åœŸç”¢ã€‘ï¼šå—éƒ¨ä»™è²ã€æˆ¶ç”°ä¹…å†·éºµã€é‡‘è¬ã€‚',
            guideTips: 'ç››å²¡å†·éºµå£æ„Ÿéå¸¸Qå½ˆï¼Œæ­é…ç‡’è‚‰çµ•é…ï¼',
            expenses: [{ item: 'æ™šé¤', cost: 3000 }, { item: 'åœŸç”¢', cost: 1500 }], tags: ['å¿…åƒ', 'å†·éºµ'], completed: false
          },
          {
            id: 'd3-15', day: 3, time: '19:30', endTime: '19:51', type: 'luggage',
            title: 'ğŸ§³ å–è¡Œæ & å‰å¾€æœˆå°', location: 'ç››å²¡ç«™ ç½®ç‰©æ«ƒ',
            description: 'ä¸Šè»Šå‰å‹™å¿…å–å› å°è¡Œæç®±ã€‚',
            guideTips: '',
            expenses: [], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd3-16', day: 3, time: '19:51', endTime: '20:41', type: 'transport',
            title: 'æ–°å¹¹ç·š Komachi 35è™Ÿ -> ç§‹ç”°', location: 'ç§‹ç”°ç«™',
            description: 'æ­ä¹˜ æ–°å¹¹ç·š Komachi 35è™Ÿ å‰å¾€ç§‹ç”°ã€‚\n20:41 æŠµé”ç§‹ç”°ç«™ã€‚',
            guideTips: '',
            expenses: [], tags: ['JR Pass'], completed: false
          },
          {
            id: 'd3-17', day: 3, time: '20:50', endTime: '21:30', type: 'hotel',
            title: 'Check-in & è¡Œæå¤§æœƒå¸«', location: 'Richmond Hotel ç§‹ç”°ç«™å‰',
            description: 'å‰å¾€é£¯åº— Check-inã€‚\nğŸ§³ ã€è¡Œæå¤§æœƒå¸«ã€‘ï¼šå‘æ«ƒå°é ˜å– Day 1 å¯„ä¾†çš„ å¤§è¡Œæç®±ã€‚',
            guideTips: 'çµ‚æ–¼å’Œå¤§è¡Œæç®±æœƒåˆäº†ï¼',
            expenses: [{ item: 'ä½å®¿', cost: 8000 }], tags: ['ä½å®¿', 'è¡Œææœƒåˆ'], completed: false
          },
          {
            id: 'd3-18', day: 3, time: '21:30', endTime: '22:30', type: 'food',
            title: 'å®µå¤œå»ºè­° (ä¸‰é¸ä¸€)', location: 'ç§‹ç”°ç«™å‰',
            description: '1. æœ«å»£æ‹‰éºµæœ¬èˆ– (ç«™å‰åˆ†åº—)ï¼šæ·±è‰²é†¬æ²¹æ¹¯åº•ï¼Œè”¥èŠ±ç„¡é™åŠ ã€‚\n2. ç§‹ç”°ç‰›ç„äº­ï¼šé«˜å“è³ªç‡’è‚‰ (éœ€ç¢ºèªç‡Ÿæ¥­æ™‚é–“)ã€‚\n3. ç„¡é™å ‚ï¼šç¨»åº­çƒé¾éºµ (è‹¥æƒ³åƒæ¶ˆå¤œå ´)ã€‚',
            guideTips: 'æœ«å»£æ‹‰éºµæ˜¯ç•¶åœ°äººçš„æ·±å¤œé£Ÿå ‚ã€‚',
            expenses: [{ item: 'å®µå¤œ', cost: 1200 }], tags: ['å®µå¤œ', 'æ‹‰éºµ'], completed: false
          },
          {
            id: 'd4-1', day: 4, time: '09:00', endTime: '09:15', type: 'luggage',
            title: 'Check-out & å¯„æ”¾æ‰€æœ‰è¡Œæ', location: 'Richmond Hotel ç§‹ç”°ç«™å‰',
            description: 'é£¯åº— Check-outã€‚\nğŸ§³ è¡Œæå‹•ä½œï¼šå°‡ å¤§è¡Œæç®± + å°è¡Œæç®± å…¨æ•¸å¯„æ”¾åœ¨ Richmond Hotel æ«ƒå° (çœéŒ¢ä¸”æ–¹ä¾¿)ã€‚',
            guideTips: 'ä»Šæ—¥é‡é»ï¼šæœ€å¾Œè§€å…‰èˆ‡æ©Ÿå ´æ¡è²·ï¼Œç¢ºä¿æº–æ™‚æ­ä¸Šåˆ©æœ¨æ´¥å·´å£«ã€‚',
            expenses: [], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd4-2', day: 4, time: '09:15', endTime: '11:00', type: 'spot',
            title: 'ã€æ™¯é»ã€‘ç§‹ç”°å¸‚å€è§€å…‰', location: 'åƒç§‹å…¬åœ’',
            description: '1. åƒç§‹å…¬åœ’ (ä¹…ä¿ç”°åŸè·¡)ï¼šé›ªæ™¯å„ªç¾ï¼Œå¯ä¿¯ç°å¸‚å€ã€‚\n2. ç§‹ç”°ç¸£ç«‹ç¾è¡“é¤¨ï¼šå®‰è—¤å¿ é›„å»ºç¯‰ï¼Œé¤¨è—è—¤ç”°å—£æ²»å£ç•«ã€‚\n3. æ°‘ä¿—è—èƒ½å‚³æ‰¿é¤¨ (Neburi Nagashi Kan)ï¼šé«”é©—æ’ç«¿ç‡ˆç¥­å…¸æ°£æ°›ã€‚',
            guideTips: 'åƒç§‹å…¬åœ’çš„é›ªæ™¯éå¸¸æ¼‚äº®ï¼Œç¾è¡“é¤¨çš„å»ºç¯‰ä¹Ÿå€¼å¾—ä¸€çœ‹ã€‚',
            expenses: [{ item: 'é–€ç¥¨', cost: 500 }], tags: ['è§€å…‰'], completed: false
          },
          {
            id: 'd4-3', day: 4, time: '11:00', endTime: '11:30', type: 'luggage',
            title: 'ğŸ§³ é ˜å–è¡Œæ & å‰å¾€å·´å£«ç«™', location: 'Richmond Hotel -> è¥¿å£å·´å£«ç«™',
            description: 'å›é£¯åº—é ˜å–æ‰€æœ‰è¡Œæï¼Œæ¨å»è¥¿å£å·´å£«ç«™ã€‚',
            guideTips: 'é ç•™æ™‚é–“æ¨è¡Œæå»è»Šç«™ã€‚',
            expenses: [], tags: ['è¡Œæå‹•ä½œ'], completed: false
          },
          {
            id: 'd4-4', day: 4, time: '11:30', endTime: '12:10', type: 'transport',
            title: 'åˆ©æœ¨æ´¥å·´å£« -> ç§‹ç”°æ©Ÿå ´', location: 'ç§‹ç”°ç«™è¥¿å£',
            description: 'æ­ä¹˜ æ©Ÿå ´åˆ©æœ¨æ´¥å·´å£« å‰å¾€ç§‹ç”°æ©Ÿå ´ã€‚\n12:10 æŠµé”ç§‹ç”°æ©Ÿå ´ã€‚',
            guideTips: 'æº–æ™‚å‡ºç™¼ï¼',
            expenses: [{ item: 'å·´å£«', cost: 950 }], tags: ['å»æ©Ÿå ´'], completed: false
          },
          {
            id: 'd4-5', day: 4, time: '12:20', endTime: '13:30', type: 'shopping',
            title: 'åˆé¤/æœ€å¾Œæ¡è²·å»ºè­°', location: 'ç§‹ç”°æ©Ÿå ´',
            description: 'ä¸‰é¸ä¸€ï¼š\n1. ç§‹ç”°æ¯”å…§åœ°é›å±‹ï¼šæ»‘å«©è¦ªå­ä¸¼ã€‚\n2. ä½è—¤é¤ŠåŠ©ï¼šå¿…åƒç¨»åº­çƒé¾éºµã€‚\n3. æ©Ÿå ´é¤å»³ï¼šæœ€å¾Œä¸€æ¬¡ç±³æ£’é‹ã€‚\nğŸ ã€æ©Ÿå ´åœŸç”¢ã€‘ï¼šç…™ç‡»è˜¿è””æ¼¬ (ã„ã¶ã‚ŠãŒã£ã“)ã€é»ƒé‡‘å¥¶æ²¹éº»ç³¬ (Butter Mochi)ã€ç§‹ç”°çŠ¬å¸ƒå¶ã€‚',
            guideTips: 'æŠŠå‰©ä¸‹çš„æ—¥å¹£èŠ±å…‰å§ï¼',
            expenses: [{ item: 'åˆé¤', cost: 1500 }, { item: 'ä¼´æ‰‹ç¦®', cost: 3000 }], tags: ['åˆé¤', 'ä¼´æ‰‹ç¦®'], completed: false
          },
          {
            id: 'd4-6', day: 4, time: '14:00', endTime: '16:00', type: 'transport',
            title: 'æ­æ©Ÿè¿”å®¶', location: 'ç§‹ç”°æ©Ÿå ´',
            description: 'æ­æ©Ÿè¿”å®¶ã€‚æ—…é€”åœ“æ»¿çµæŸï¼',
            guideTips: 'Safe Flight!',
            expenses: [], tags: ['å›å®¶'], completed: false
          },
        ];

        // --- Icon Helpers (Inline SVG) ---
        const iconSVG = (name, size = 18, className = '') => {
            const icons = {
                MapPin: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`,
                Clock: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>`,
                Snowflake: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M2 12h20"/><path d="m13.2 2a2 2 0 1 0-2.4 0"/><path d="M12 2v20"/><path d="M4.9 4.9l8.4 8.4m-4.2 0l8.4 8.4m-8.4-4.2l8.4-8.4m-4.2 4.2l8.4-8.4"/><path d="m4.9 19.1 8.4-8.4m-4.2 0 8.4-8.4m-8.4 4.2 8.4 8.4m-4.2-4.2 8.4 8.4"/></svg>`,
                Utensils: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M9 19H7a4 4 0 0 0-4 4V23"/><path d="M15 2v7a2 2 0 0 1-2 2h-4"/><path d="M15 19h2a4 4 0 0 0 4-4V23"/><path d="M17 2v7a2 2 0 0 0 2-2V2"/></svg>`,
                Train: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="m2 8 4 6 4-2 4 4 4-2 4 6"/><path d="M7 21a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7z"/><path d="M7 15h10"/><path d="M10 3h4"/><path d="M12 3v2"/></svg>`,
                BedDouble: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M18 20V8a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v12M2 20h20M2 14h20M13 14h4M7 14h-3M16 20v-2M8 20v-2"/></svg>`,
                Camera: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>`,
                ShoppingBag: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>`,
                Calculator: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><path d="M8 7h8"/><path d="M8 11h2v2H8z"/><path d="M11 11h2v2h-2z"/><path d="M14 11h2v2h-2z"/><path d="M8 14h2v2H8z"/><path d="M11 14h2v2h-2z"/><path d="M14 14h2v2h-2z"/><path d="M8 17h2v2H8z"/><path d="M11 17h2v2h-2z"/><path d="M14 17h2v2h-2z"/></svg>`,
                Plus: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M12 5v14M5 12h14"/></svg>`,
                ArrowRight: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M5 12h14M12 5l7 7-7 7"/></svg>`,
                Navigation: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>`,
                Home: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>`,
                Info: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>`,
                X: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M18 6L6 18M6 6l12 12"/></svg>`,
                Edit2: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M17 3a2.828 2.828 1 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>`,
                Trash2: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6"/></svg>`,
                Calendar: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M8 2v4M16 2v4M21 7H3M4 5h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2z"/></svg>`,
            };
            return icons[name] || '';
        };

        const getTypeColor = (type) => {
            switch (type) {
                case 'food': return { bg: 'bg-orange-100', text: 'text-orange-700', border: 'border-orange-200', stripe: 'bg-orange-600' };
                case 'transport': return { bg: 'bg-blue-100', text: 'text-blue-700', border: 'border-blue-200', stripe: 'bg-blue-600' };
                case 'spot': return { bg: 'bg-green-100', text: 'text-green-700', border: 'border-green-200', stripe: 'bg-green-600' };
                case 'hotel': return { bg: 'bg-purple-100', text: 'text-purple-700', border: 'border-purple-200', stripe: 'bg-purple-600' };
                case 'luggage': return { bg: 'bg-yellow-100', text: 'text-yellow-800', border: 'border-yellow-300', stripe: 'bg-yellow-600' };
                case 'shopping': return { bg: 'bg-pink-100', text: 'text-pink-700', border: 'border-pink-200', stripe: 'bg-pink-600' };
                default: return { bg: 'bg-gray-100', text: 'text-gray-700', border: 'border-gray-200', stripe: 'bg-gray-600' };
            }
        };

        const getTypeIconName = (type) => {
            switch (type) {
                case 'food': return 'Utensils';
                case 'transport': return 'Train';
                case 'spot': return 'Camera';
                case 'hotel': return 'BedDouble';
                case 'luggage': return 'ShoppingBag';
                case 'shopping': return 'ShoppingBag';
                default: return 'Clock';
            }
        };

        const formatMoney = (jpy) => `Â¥${jpy.toLocaleString()}`;
        const formatTWD = (jpy) => `NT$${Math.round(jpy * state.exchangeRate).toLocaleString()}`;

        const openNavigation = (loc) => {
            if (!loc) return;
            const query = encodeURIComponent(loc);
            window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
        };

        // --- Data Management (LocalStorage) ---

        const loadData = () => {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    state.events = JSON.parse(saved);
                } catch (e) {
                    console.error("Parse error", e);
                    state.events = INITIAL_ITINERARY;
                }
            } else {
                state.events = INITIAL_ITINERARY;
            }
            // Sort
            state.events.sort((a, b) => {
                if (a.day !== b.day) return a.day - b.day;
                return String(a.time).localeCompare(String(b.time));
            });
        };

        const saveToStorage = () => {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state.events));
        };

        // --- CRUD Handlers ---

        const updateItem = (updatedItem) => {
            // Recalculate cost
            const newTotalCost = (updatedItem.expenses || []).reduce((sum, e) => sum + (e.cost || 0), 0);
            const itemToSave = { ...updatedItem, cost: newTotalCost };

            const idx = state.events.findIndex(e => e.id === itemToSave.id);
            if (idx !== -1) {
                state.events[idx] = itemToSave;
                saveToStorage();
                state.editItem = null;
                render();
            }
        };

        const deleteItem = (id) => {
            state.events = state.events.filter(e => e.id !== id);
            saveToStorage();
            state.editItem = null;
            state.deleteConfirmId = null;
            render();
        };

        const addItem = () => {
            const newId = `new-${Date.now()}`;
            const newItem = {
                id: newId,
                day: state.currentDay,
                time: '12:00',
                endTime: '13:00',
                type: 'spot',
                title: 'æ–°è¡Œç¨‹',
                location: 'è«‹è¼¸å…¥åœ°é»',
                description: 'è«‹è¼¸å…¥è¡Œç¨‹ç´°ç¯€',
                guideTips: '',
                expenses: [],
                cost: 0,
                tags: [],
                completed: false
            };
            state.events.push(newItem);
            saveToStorage();
            state.editItem = newItem;
            render();
        };

        // --- UI Rendering Functions ---

        const renderHome = () => {
            appContainer.className = "h-screen w-full bg-[#f4f1ea] flex flex-col items-center justify-center relative overflow-hidden font-sans";
            appContainer.innerHTML = `
                <div class="absolute top-[-50px] right-[-50px] w-64 h-64 bg-green-200/30 rounded-full blur-3xl"></div>
                <div class="absolute bottom-[-50px] left-[-50px] w-64 h-64 bg-orange-200/30 rounded-full blur-3xl"></div>

                <div class="z-10 text-center space-y-6 p-8">
                    <div class="inline-block p-4 bg-white rounded-full shadow-xl mb-4 animate-bounce-slow">
                        <div class="text-6xl">ğŸŒ±</div>
                    </div>
                    <h1 class="text-4xl font-bold text-[#5c6b54] tracking-tight">é¾è²“æ—…è¨˜</h1>
                    <p class="text-slate-500 text-lg">æ±åŒ—é›ªè¦‹ä¹‹æ—… ãƒ» 2026/1/15</p>
                    
                    <div class="bg-white/60 backdrop-blur-md rounded-2xl p-6 shadow-lg border border-white/50 w-64 mx-auto">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-bold text-slate-400 uppercase">ç•¶å‰å¤©æ°£</span>
                            ${iconSVG('MapPin', 14, 'text-slate-400')}
                        </div>
                        <div class="flex items-center justify-center gap-4">
                             <span class="text-blue-400 w-12 h-12">${iconSVG('Snowflake', 48)}</span>
                             <div class="text-left">
                                 <div class="text-3xl font-bold text-slate-700">-2Â°C</div>
                                 <div class="text-xs text-slate-500">é’æ£®å¸‚ ãƒ» å¤§é›ª</div>
                             </div>
                        </div>
                    </div>

                    <button id="start-trip-btn" class="bg-[#6b8c72] hover:bg-[#5a7660] text-white text-lg font-bold py-3 px-10 rounded-full shadow-xl transition-all hover:scale-105 active:scale-95 flex items-center gap-2 mx-auto">
                        é–‹å§‹æ—…ç¨‹ ${iconSVG('ArrowRight', 20)}
                    </button>
                </div>
            `;
            document.getElementById('start-trip-btn').onclick = () => {
                state.view = 'app';
                render();
            };
        };
        
        const createEventCard = (item) => {
            const colors = getTypeColor(item.type);
            const typeIcon = getTypeIconName(item.type);
            const totalCost = (item.expenses || []).reduce((sum, e) => sum + (e.cost || 0), 0);

            const card = document.createElement('div');
            card.className = "flex gap-3 relative group";
            card.innerHTML = `
                <!-- Time Node -->
                <div class="flex-none w-14 pt-1 flex flex-col items-center z-10 bg-[#f4f1ea]">
                   <span class="text-xs font-bold text-slate-600 font-mono">${item.time}</span>
                   <div class="mt-1 w-3 h-3 rounded-full border-2 border-white shadow-sm ${item.completed ? 'bg-slate-400' : 'bg-[#e67e22]'}"></div>
                   ${item.endTime ? `<span class="text-[10px] text-slate-400 mt-auto mb-1 opacity-70">${item.endTime}</span>` : ''}
                </div>

                <!-- Card -->
                <div data-id="${item.id}" class="flex-1 rounded-2xl p-3 shadow-md border border-slate-100 bg-white relative overflow-hidden active:scale-[0.98] transition-all cursor-pointer hover:shadow-lg">
                    <div class="absolute top-0 left-0 w-1.5 h-full ${colors.stripe}"></div>

                    <!-- Header -->
                    <div class="flex justify-between items-start mb-2 pl-2">
                        <div class="flex items-center gap-2">
                             <div class="p-1.5 rounded-full ${colors.bg} ${colors.text}">
                                ${iconSVG(typeIcon, 18)}
                             </div>
                             <h3 class="font-bold text-slate-800 leading-tight text-base">${item.title}</h3>
                        </div>
                        ${item.type !== 'transport' ? '<div class="flex items-center gap-1 bg-white/80 px-2 py-1 rounded-full text-xs font-medium shadow-sm text-slate-600"><span class="text-blue-400">' + iconSVG('Snowflake', 20) + '</span><span>-5Â°C å¤§é›ª</span></div>' : ''}
                    </div>

                    <!-- Details -->
                    <div class="pl-2 space-y-2">
                         ${item.location ? `
                             <div data-loc="${item.location}" class="location-link flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800 underline decoration-blue-300 underline-offset-2 cursor-pointer w-fit">
                                 ${iconSVG('MapPin', 12)} ${item.location}
                             </div>
                         ` : ''}
                         
                         ${item.description ? `<p class="text-sm text-slate-600 whitespace-pre-line leading-relaxed">${item.description.replace(/\n/g, '<br>')}</p>` : ''}

                         ${item.guideTips ? `
                             <div class="bg-yellow-50/80 p-2 rounded text-xs text-yellow-900 border-l-2 border-yellow-400 mt-2">
                                 <span class="font-bold mr-1">ğŸ’¡ å°éŠèªª:</span> ${item.guideTips}
                             </div>
                         ` : ''}

                         <!-- Cost Pill -->
                         <div class="flex justify-between items-center pt-2 mt-1 border-t border-dashed border-slate-100">
                             <div class="flex gap-1 flex-wrap">
                                 ${(item.tags || []).map(tag => `<span class="text-[10px] px-1.5 py-0.5 rounded bg-slate-100 text-slate-600">${tag}</span>`).join('')}
                             </div>
                             ${totalCost > 0 ? `<div class="text-xs font-mono font-bold text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full">${formatMoney(totalCost)}</div>` : ''}
                         </div>
                    </div>
                    
                    <!-- Navigation FAB on Card -->
                    <button data-loc="${item.location}" class="nav-fab absolute bottom-3 right-3 bg-[#6b8c72]/10 hover:bg-[#6b8c72] text-[#6b8c72] hover:text-white p-2 rounded-full transition-all">
                        ${iconSVG('Navigation', 16)}
                    </button>
                </div>
            `;
            
            card.querySelector(`[data-id="${item.id}"]`).onclick = () => {
                state.editItem = JSON.parse(JSON.stringify(item)); // Deep clone
                renderEditModal();
            };

            const locLinks = card.querySelectorAll('.location-link');
            locLinks.forEach(link => {
                link.onclick = (e) => { e.stopPropagation(); openNavigation(e.currentTarget.dataset.loc); };
            });

            const navFabs = card.querySelectorAll('.nav-fab');
            navFabs.forEach(fab => {
                fab.onclick = (e) => { e.stopPropagation(); openNavigation(e.currentTarget.dataset.loc); };
            });

            return card;
        };

        const renderApp = () => {
            const dayEvents = state.events.filter(e => e.day === state.currentDay);
            const dayCostJPY = dayEvents.reduce((sum, e) => sum + (e.cost || 0), 0);
            
            appContainer.className = "h-screen w-full bg-[#f4f1ea] font-sans text-slate-700 overflow-hidden flex flex-col relative";
            appContainer.innerHTML = `
                <!-- Header -->
                <header class="flex-none bg-[#6b8c72] text-white pt-4 pb-2 px-4 shadow-lg z-20 relative">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-3">
                            <button id="home-btn" class="bg-white/20 p-1.5 rounded-full hover:bg-white/30 transition-colors">
                                ${iconSVG('Home', 18)}
                            </button>
                            <div>
                                <h1 class="text-lg font-bold leading-none">Day ${state.currentDay}</h1>
                                <p class="text-xs text-white/80 opacity-90 mt-0.5">
                                    ${state.currentDay === 1 ? "æ¨¹å†°èˆ‡å¤œæ«»" : state.currentDay === 2 ? "ç‹ç‹¸èˆ‡ç§˜æ¹¯" : state.currentDay === 3 ? "é›™æº«æ³‰èˆ‡å†·éºµ" : "ç§‹ç”°å·¡ç¦®"}
                                </p>
                            </div>
                        </div>
                        <div id="budget-pill" class="bg-white/10 backdrop-blur-sm rounded-lg p-2 text-right cursor-pointer">
                            <div class="text-[10px] text-white/70 uppercase">æ¯æ—¥é ç®—</div>
                            <div class="font-bold text-sm leading-none mb-0.5">${formatMoney(dayCostJPY)}</div>
                            <div class="text-[10px] text-yellow-200 leading-none">${formatTWD(dayCostJPY)}</div>
                        </div>
                    </div>

                    <!-- Currency Input -->
                    <div id="rate-editor" class="mb-2 flex items-center gap-2 justify-end text-xs bg-[#5a7660] p-2 rounded-lg transition-all ${state.isRateEditing ? '' : 'hidden'}">
                        <span>åŒ¯ç‡è¨­å®š:</span>
                        <input id="exchange-rate-input" type="number" value="${state.exchangeRate}" step="0.001" class="w-16 text-black px-1 rounded text-center"/>
                    </div>

                    <!-- Day Switcher -->
                    <div id="day-switcher" class="flex gap-2 mt-2 overflow-x-auto pb-1 no-scrollbar">
                        <!-- Buttons dynamically injected -->
                    </div>
                </header>

                <!-- Main List -->
                <main id="main-list" class="flex-1 overflow-y-auto p-4 pb-24 relative">
                    <div class="absolute left-[26px] top-0 bottom-0 w-0.5 bg-slate-300/50 z-0"></div>
                    <div id="event-list" class="space-y-6 relative z-10">
                        <!-- Event cards dynamically injected -->
                    </div>
                </main>

                <!-- Floating Action Button -->
                <button id="add-btn" class="absolute bottom-6 right-6 w-14 h-14 bg-[#e67e22] text-white rounded-full shadow-xl flex items-center justify-center hover:bg-[#d35400] active:scale-90 z-30 transition-transform">
                    ${iconSVG('Plus', 28)}
                </button>
            `;

            // --- Attach Event Listeners ---
            document.getElementById('home-btn').onclick = () => {
                state.view = 'home';
                render();
            };
            
            document.getElementById('budget-pill').onclick = () => {
                state.isRateEditing = !state.isRateEditing;
                render();
            };

            const rateInput = document.getElementById('exchange-rate-input');
            if (rateInput) {
                rateInput.onchange = (e) => {
                    state.exchangeRate = parseFloat(e.target.value) || 0;
                    render();
                };
            }
            
            document.getElementById('add-btn').onclick = addItem;

            // Render Day Switcher Buttons
            const daySwitcher = document.getElementById('day-switcher');
            [1, 2, 3, 4].forEach(day => {
                const btn = document.createElement('button');
                btn.className = `flex-shrink-0 px-4 py-1.5 rounded-full text-xs font-bold transition-all shadow-sm flex items-center gap-1 ${state.currentDay === day ? 'bg-[#e8dec6] text-[#5c4b35] scale-105 ring-2 ring-white/50' : 'bg-white/20 text-white hover:bg-white/30'}`;
                btn.innerHTML = `${iconSVG('Calendar', 12)} Day ${day}`;
                btn.onclick = () => {
                    state.currentDay = day;
                    // Reset scroll to top when changing day
                    document.getElementById('main-list').scrollTop = 0;
                    render();
                };
                daySwitcher.appendChild(btn);
            });

            // Render Event Cards
            const eventList = document.getElementById('event-list');
            if (dayEvents.length === 0) {
                eventList.innerHTML = `<div class="text-center py-20 opacity-40">å°šç„¡è¡Œç¨‹ï¼Œè«‹é»æ“Šå³ä¸‹è§’æ–°å¢</div>`;
            } else {
                dayEvents.forEach(item => {
                    eventList.appendChild(createEventCard(item));
                });
            }
        };

        const renderEditModal = () => {
            if (!state.editItem) {
                editModal.classList.add('hidden');
                modalContent.innerHTML = '';
                state.deleteConfirmId = null;
                return;
            }

            editModal.classList.remove('hidden');

            const item = state.editItem;
            const typeOptions = [
                { id: 'spot', name: 'æ™¯é»' }, { id: 'food', name: 'ç¾é£Ÿ' }, { id: 'transport', name: 'äº¤é€š' },
                { id: 'hotel', name: 'ä½å®¿' }, { id: 'luggage', name: 'è¡Œæ' }, { id: 'shopping', name: 'è³¼ç‰©' }
            ];

            const expensesHtml = (item.expenses || []).map((ex, idx) => `
                <div class="flex justify-between items-center text-sm border-b border-dashed pb-1 expense-item" data-idx="${idx}">
                    <span>${ex.item}</span>
                    <div class="flex items-center gap-2">
                        <span class="font-mono">Â¥${ex.cost}</span>
                        <button type="button" class="remove-expense-btn text-red-400 hover:text-red-600">
                            ${iconSVG('X', 12)}
                        </button>
                    </div>
                </div>
            `).join('');

            const total = (item.expenses || []).reduce((sum, e) => sum + (e.cost || 0), 0);

            modalContent.innerHTML = `
                <!-- Modal Header -->
                <div class="p-4 bg-[#f4f1ea] border-b flex justify-between items-center flex-none">
                    <h2 class="font-bold text-lg flex items-center gap-2 text-slate-700">
                        ${iconSVG('Edit2', 18)} ç·¨è¼¯è¡Œç¨‹
                    </h2>
                    <button id="modal-close-btn" class="p-2 hover:bg-slate-200 rounded-full transition-colors">${iconSVG('X', 20, 'text-slate-500')}</button>
                </div>
                
                <!-- Modal Body -->
                <div class="p-4 overflow-y-auto flex-1 space-y-5">
                    
                    <!-- Day/Time/Title -->
                    <div class="grid grid-cols-5 gap-3">
                        <div class="col-span-1">
                            <label class="text-xs text-slate-400 block mb-1">Day</label>
                            <input id="edit-day-input" type="number" value="${item.day}" class="w-full bg-slate-50 border rounded-lg p-2 font-mono text-sm" />
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-400 block mb-1">æ™‚é–“</label>
                            <input id="edit-time-input" type="time" value="${item.time}" class="w-full bg-slate-50 border rounded-lg p-2 font-mono text-sm" />
                        </div>
                        <div class="col-span-2">
                            <label class="text-xs text-slate-400 block mb-1">çµæŸ</label>
                            <input id="edit-endtime-input" type="time" value="${item.endTime || ''}" class="w-full bg-slate-50 border rounded-lg p-2 font-mono text-sm" />
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 block mb-1">æ¨™é¡Œ</label>
                        <input id="edit-title-input" type="text" value="${item.title}" class="w-full bg-slate-50 border rounded-lg p-2 text-sm font-bold" />
                    </div>

                    <!-- Location & Navigation -->
                    <div>
                        <label class="text-xs text-slate-400 block mb-1">åœ°é» (å°èˆªç”¨)</label>
                        <div class="flex gap-2">
                             <input id="edit-location-input" type="text" value="${item.location}" class="flex-1 bg-slate-50 border rounded-lg p-2 text-sm" placeholder="è¼¸å…¥åœ°é»åç¨±" />
                             <button id="modal-nav-btn" type="button" class="bg-blue-100 text-blue-600 p-2 rounded-lg hover:bg-blue-200">${iconSVG('Navigation', 18)}</button>
                        </div>
                    </div>

                    <!-- Type Selector -->
                    <div>
                        <label class="text-xs text-slate-400 block mb-1">é¡å‹</label>
                        <div id="type-selector" class="flex gap-2 overflow-x-auto pb-1 no-scrollbar">
                            ${typeOptions.map(t => `
                                <button data-type="${t.id}" type="button" class="type-btn px-3 py-1.5 rounded-full text-xs font-medium border flex-shrink-0 transition-colors ${item.type === t.id ? 'bg-slate-700 text-white border-slate-700' : 'bg-white text-slate-500 border-slate-200'}">
                                    ${t.name}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Descriptions -->
                    <div>
                        <label class="text-xs text-slate-400 block mb-1">è©³ç´°å…§å®¹</label>
                        <textarea id="edit-description-input" class="w-full bg-slate-50 border rounded-lg p-2 text-sm h-20" placeholder="è¡Œç¨‹å‚™è¨»...">${item.description}</textarea>
                    </div>

                    <!-- Guide Tips Section -->
                    <div>
                        <label class="text-xs text-yellow-600 font-bold block mb-1 flex items-center gap-1">${iconSVG('Info', 12)} å°éŠç­†è¨˜</label>
                        <textarea id="edit-tips-input" class="w-full bg-yellow-50 border border-yellow-200 rounded-lg p-2 text-sm h-20 placeholder-yellow-800/30" placeholder="è¼¸å…¥æ™¯é»æ•…äº‹ã€æ”»ç•¥ã€æ³¨æ„äº‹é …...">${item.guideTips || ''}</textarea>
                    </div>

                    <!-- Expense Tracker -->
                    <div id="expense-tracker" class="bg-white rounded-lg p-3 border border-slate-200 shadow-inner">
                        <h4 class="text-sm font-bold text-slate-600 mb-2 flex items-center gap-2">
                            ${iconSVG('Calculator', 14)} è¨˜å¸³å°å¹«æ‰‹
                        </h4>
                        <div id="expense-list" class="space-y-2 mb-3 max-h-32 overflow-y-auto">
                            ${expensesHtml || '<div class="text-xs text-slate-400 italic">å°šæœªæ–°å¢æ¶ˆè²»é …ç›®</div>'}
                        </div>
                        
                        <div class="flex gap-2 mb-2">
                            <input id="new-expense-item" type="text" placeholder="é …ç›® (å¦‚: åˆé¤)" class="flex-1 text-xs p-1.5 border rounded"/>
                            <input id="new-expense-cost" type="number" placeholder="é‡‘é¡" class="w-20 text-xs p-1.5 border rounded"/>
                            <button id="add-expense-btn" type="button" class="bg-blue-500 text-white p-1.5 rounded hover:bg-blue-600">${iconSVG('Plus', 14)}</button>
                        </div>
                        <div class="text-right font-bold text-slate-700 text-sm">
                            ç¸½è¨ˆ: Â¥${total.toLocaleString()}
                        </div>
                    </div>

                </div>

                <!-- Modal Footer -->
                <div class="p-4 border-t bg-slate-50 flex justify-between items-center flex-none">
                    <button id="modal-delete-btn" type="button" class="px-4 py-2 rounded-lg text-sm flex items-center gap-1 transition-all ${state.deleteConfirmId === item.id ? 'bg-red-600 text-white' : 'text-red-500 hover:bg-red-100'}">
                        ${iconSVG('Trash2', 16)} ${state.deleteConfirmId === item.id ? 'ç¢ºå®šåˆªé™¤?' : 'åˆªé™¤'}
                    </button>
                    <button id="modal-save-btn" type="button" class="bg-[#6b8c72] text-white px-8 py-2.5 rounded-lg font-bold shadow hover:bg-[#5a7660] active:scale-95 transition-all">
                        å„²å­˜
                    </button>
                </div>
            `;
            
            // --- Attach Modal Event Listeners ---
            
            const updateEditState = (key, value) => {
                state.editItem[key] = value;
            };

            document.getElementById('edit-day-input').onchange = (e) => updateEditState('day', parseInt(e.target.value));
            document.getElementById('edit-time-input').onchange = (e) => updateEditState('time', e.target.value);
            document.getElementById('edit-endtime-input').onchange = (e) => updateEditState('endTime', e.target.value);
            document.getElementById('edit-title-input').onchange = (e) => updateEditState('title', e.target.value);
            document.getElementById('edit-location-input').onchange = (e) => updateEditState('location', e.target.value);
            document.getElementById('edit-description-input').onchange = (e) => updateEditState('description', e.target.value);
            document.getElementById('edit-tips-input').onchange = (e) => updateEditState('guideTips', e.target.value);

            // Type selector
            modalContent.querySelectorAll('.type-btn').forEach(btn => {
                btn.onclick = (e) => {
                    const newType = e.currentTarget.dataset.type;
                    state.editItem.type = newType;
                    renderEditModal(); 
                };
            });

            // Expense handlers
            const updateExpenses = (newExpenses) => {
                state.editItem.expenses = newExpenses;
                renderEditModal(); 
            };

            document.getElementById('add-expense-btn').onclick = () => {
                const newItem = document.getElementById('new-expense-item').value.trim();
                const newCost = parseInt(document.getElementById('new-expense-cost').value);
                if (newItem && !isNaN(newCost) && newCost > 0) {
                    const newExpenses = [...(state.editItem.expenses || []), { item: newItem, cost: newCost }];
                    updateExpenses(newExpenses);
                }
            };
            
            document.querySelectorAll('.remove-expense-btn').forEach(btn => {
                btn.onclick = (e) => {
                    const itemElement = e.currentTarget.closest('.expense-item');
                    const idx = parseInt(itemElement.dataset.idx);
                    const newExpenses = state.editItem.expenses.filter((_, i) => i !== idx);
                    updateExpenses(newExpenses);
                };
            });
            
            document.getElementById('modal-close-btn').onclick = () => {
                state.editItem = null;
                render();
            };
            document.getElementById('modal-save-btn').onclick = () => {
                updateItem(state.editItem);
            };
            document.getElementById('modal-nav-btn').onclick = () => {
                openNavigation(document.getElementById('edit-location-input').value);
            };

            document.getElementById('modal-delete-btn').onclick = () => {
                if (state.deleteConfirmId === item.id) {
                    deleteItem(item.id);
                } else {
                    state.deleteConfirmId = item.id;
                    renderEditModal(); 
                }
            };

        };

        // --- Main Render Loop ---
        const render = () => {
            if (state.view === 'home') {
                renderHome();
                editModal.classList.add('hidden');
            } else {
                renderApp();
                if (state.editItem) {
                    renderEditModal();
                } else {
                    editModal.classList.add('hidden');
                }
            }
        };

        // --- Init ---
        loadData();
        render();
</script>

<!--  PWA Service Worker è¨»å†Šç¨‹å¼ç¢¼æ”¾é€™è£¡ -->
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("âœ… Service Worker registered"))
        .catch(err => console.log("âŒ Service Worker registration failed:", err));
    });
  }
</script>
</body>

</html>
